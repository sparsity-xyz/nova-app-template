version: v1
name: "nova-app"
target: "nova-app:latest"

sources:
  app: "."

# Odyn Primary API (full functionality)
api:
  listen_port: 18000

# Odyn Auxiliary API (restricted, for sidecars)
aux_api:
  listen_port: 18001

# Application ingress - listen_port must match the "App Listening Port" 
# specified when creating the app on the Nova platform.
ingress:
  - listen_port: 8000
  - listen_port: 18001

# Egress for external API calls
# NOTE: Nova platform manages this automatically for you.
egress:
  allow:
    - "**"           # All domains
    - "0.0.0.0/0"    # All IPv4
    - "::/0"         # All IPv6

# Nova KMS + app wallet integration (auth chain: Base Sepolia)
# NOTE: Replace `kms_app_id` and `base_urls` with your real deployment values.
kms_integration:
  enabled: true
  kms_app_id: 1001
  nova_app_registry: "0x0f68E6e699f2E972998a1EcC000c7ce103E64cc8"
  registry_chain_rpc: "https://sepolia.base.org"
  base_urls:
    - "https://kms-node-1.example.com"
    - "https://kms-node-2.example.com"
  request_timeout_ms: 3000
  max_retries: 2
  discovery_ttl_ms: 15000
  require_mutual_signature: true
  audit_log_path: "/tmp/nova-kms-audit.jsonl"
  reserved_derive_prefixes:
    - "wallet/eth/app/"

# S3 persistent storage
# NOTE: Nova platform provisions and manages these values during deployment.
storage:
  s3:
    enabled: true
    bucket: "your-bucket-name"
    prefix: "apps/your-app-id/"
    region: "us-east-1"
    encryption:
      mode: "kms"
      key_scope: "object"
      aad_mode: "key"
      key_version: "v1"
      accept_plaintext: true

# Helios trustless RPC for business chain (Ethereum mainnet)
helios_rpc:
  enabled: true
  kind: ethereum
  network: mainnet
  listen_port: 8545
  # NOTE: execution_rpc is managed/injected by Nova Platform during deployment.
  # This default is for local enclaver testing.
  execution_rpc: "https://eth-mainnet.g.alchemy.com/v2/YOUR_API_KEY"

# Resource defaults
defaults:
  cpu_count: 2
  memory_mb: 2048

# TEE Sidecars / Services
# Add other sidecars here if needed
services: []
