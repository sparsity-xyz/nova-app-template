(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{2201:function(e,t,s){Promise.resolve().then(s.bind(s,7455))},7455:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return f}});var a=s(7437),r=s(2265),l=s(3815);let n=e=>Array.from(e instanceof Uint8Array?e:new Uint8Array(e)).map(e=>e.toString(16).padStart(2,"0")).join(""),c=e=>{e.startsWith("0x")&&(e=e.slice(2));let t=new Uint8Array(e.length/2);for(let s=0;s<e.length;s+=2)t[s/2]=parseInt(e.substr(s,2),16);return t};function i(e,t){var s;let a=(null===(s=btoa(new Uint8Array(t).reduce((e,t)=>e+String.fromCharCode(t),"")).match(/.{1,64}/g))||void 0===s?void 0:s.join("\n"))||"";return"-----BEGIN ".concat(e,"-----\n").concat(a,"\n-----END ").concat(e,"-----")}function d(e){for(let t=0;t<e.length;t++){let s=e.charCodeAt(t);if(!(s>=32&&s<=126||13===s||10===s||9===s))return!1}return!0}function o(e){if(e instanceof Uint8Array||e instanceof ArrayBuffer){let t=e instanceof Uint8Array?e:new Uint8Array(e);try{let e=new TextDecoder().decode(t);if(d(e))return e}catch(e){}return btoa(t.reduce((e,t)=>e+String.fromCharCode(t),""))}if(e instanceof Map){let t={};for(let[s,a]of Array.from(e.entries()))t[String(s)]=o(a);return t}if(Array.isArray(e))return e.map(e=>o(e));if(null!==e&&"object"==typeof e){let t={};for(let[s,a]of Object.entries(e))t[s]=o(a);return t}return e}function x(e){let t=e.public_key;e instanceof Map&&(t=e.get("public_key"));let s=o(e),a=e instanceof Map?e.get("pcrs"):e.pcrs;if(a){let e={};if(a instanceof Map)for(let[t,s]of Array.from(a.entries()))e[String(t)]=s instanceof Uint8Array?n(s):o(s);else for(let[t,s]of Object.entries(a))e[t]=s instanceof Uint8Array?n(s):o(s);s.pcrs=e}if(t instanceof Uint8Array){let e=function(e){let t=new Uint8Array([48,118,48,16,6,7,42,134,72,206,61,2,1,6,5,43,129,4,0,34,3,98,0]);if(120===e.length&&48===e[0])return e;if(97!==e.length)return console.warn("[rawToDer] Unexpected key length ".concat(e.length,", returning as-is")),e;let s=new Uint8Array(t.length+e.length);return s.set(t,0),s.set(e,t.length),s}(t);s.public_key=n(e)}let r=e instanceof Map?e.get("certificate"):e.certificate;r instanceof Uint8Array&&(s.certificate=i("CERTIFICATE",r));let l=e instanceof Map?e.get("cabundle"):e.cabundle;Array.isArray(l)&&(s.cabundle=l.map(e=>e instanceof Uint8Array?i("CERTIFICATE",e):o(e)));let c=e instanceof Map?e.get("user_data"):e.user_data;if(c instanceof Uint8Array)try{let e=new TextDecoder().decode(c);if(d(e))try{s.user_data=JSON.parse(e)}catch(t){s.user_data=e}else s.user_data=n(c)}catch(e){s.user_data=n(c)}return s}async function p(e){let t=await s.e(693).then(s.t.bind(s,4693,23)),a=atob(e),r=new Uint8Array(a.length);for(let e=0;e<a.length;e++)r[e]=a.charCodeAt(e);try{let e=t.decode(r);if(Array.isArray(e)&&e.length>=3){let s=e[0],a=s;if(s instanceof Uint8Array)try{a=t.decode(s)}catch(e){}let r=e[1],l=e[2],c=e.length>3?e[3]:null,i=t.decode(l),d=x(i);return{protected_header:o(a),unprotected_header:o(r),attestation_document:d,signature:c instanceof Uint8Array?n(c):o(c),module_id:d.module_id,digest:d.digest,timestamp:d.timestamp,pcrs:d.pcrs,public_key:d.public_key,user_data:"object"==typeof d.user_data?JSON.stringify(d.user_data):d.user_data,certificate:d.certificate,cabundle:d.cabundle,nonce:d.nonce}}{let t=x(e);return{attestation_document:t,module_id:t.module_id,digest:t.digest,timestamp:t.timestamp,pcrs:t.pcrs,public_key:t.public_key,user_data:"object"==typeof t.user_data?JSON.stringify(t.user_data):t.user_data,certificate:t.certificate,cabundle:t.cabundle,nonce:t.nonce}}}catch(e){throw console.error("Failed to parse CBOR attestation:",e),Error("Failed to parse attestation data")}}async function h(e,t){let s="".concat(e.replace(/\/$/,""),"/.well-known/attestation"),a={};t&&(a.nonce=btoa(t));let r=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/cbor, application/octet-stream, application/json"},body:JSON.stringify(a)});if(!r.ok)throw Error("Failed to fetch attestation: ".concat(r.status));let l=r.headers.get("content-type")||"";if(l.includes("application/cbor")||l.includes("application/octet-stream")){let e=btoa(new Uint8Array(await r.arrayBuffer()).reduce((e,t)=>e+String.fromCharCode(t),""));return{...await p(e),raw_doc:e}}{let e=await r.json();if(e.attestation_document)return{...e,raw_doc:e.attestation_doc||JSON.stringify(e)};if(e.attestation_doc)return{...await p(e.attestation_doc),raw_doc:e.attestation_doc};throw Error("Unexpected attestation response format")}}function u(e){return Array.from(e instanceof Uint8Array?e:new Uint8Array(e)).map(e=>e.toString(16).padStart(2,"0")).join("")}function m(e){if(e.includes("2b81040022"))return"P-384";if(e.includes("2b8104000a"))return"secp256k1";let t=e.length;return 240===t||194===t?"P-384":176===t||130===t?"secp256k1":t>160?"P-384":"secp256k1"}function b(e,t){if("P-384"===t){if(120===e.length)return e.slice(23);if(97===e.length)return e}if("secp256k1"===t){if(88===e.length)return e.slice(23);if(65===e.length)return e}return console.warn("[derToRaw] Unexpected key length ".concat(e.length," for curve ").concat(t)),e}function y(e,t){if("P-384"===t){let t=c("3076301006072a8648ce3d020106082b81040022036200"),s=new Uint8Array(t.length+e.length);return s.set(t,0),s.set(e,t.length),s}{let t=c("3056301006072a8648ce3d020106052b8104000a034200"),s=new Uint8Array(t.length+e.length);return s.set(t,0),s.set(e,t.length),s}}class v{get serverEncryptionPublicKey(){return this.serverEncryptionPublicKeyDerHex}get baseUrl(){return this.enclaveBaseUrl}get connected(){return this.isConnected}async connect(e){this.enclaveBaseUrl=e.replace(/\/$/,"");let t=await this.fetchAttestation(),s=(t.public_key||"").replace(/^0x/,"");if(s)this.serverEncryptionPublicKeyDerHex=s,this.curve=m(s);else{let e=((await this.call("/api/encryption/public_key","GET")).public_key_der||"").replace(/^0x/,"");if(!e)throw Error("Failed to retrieve enclave encryption public key");this.serverEncryptionPublicKeyDerHex=e,t.public_key=e,this.curve=m(e)}if(console.log("[EnclaveClient] Detected curve: ".concat(this.curve)),"P-384"===this.curve){this.p384KeyPair=await crypto.subtle.generateKey({name:"ECDH",namedCurve:"P-384"},!0,["deriveBits"]);let e=b(c(this.serverEncryptionPublicKeyDerHex),"P-384");this.serverP384Key=await crypto.subtle.importKey("raw",e,{name:"ECDH",namedCurve:"P-384"},!0,[])}else{this.secpPrivKey=l.P6.randomSecretKey(),this.secpPubKey=l.$3(this.secpPrivKey,!1);let e=c(this.serverEncryptionPublicKeyDerHex);this.serverSecpPubKeyRaw=b(e,"secp256k1");try{let e=Array.from(this.serverSecpPubKeyRaw).map(e=>e.toString(16).padStart(2,"0")).join("");l.E9.fromHex(e)}catch(e){throw Error("Invalid server public key: ".concat(e instanceof Error?e.message:String(e)))}}return this.isConnected=!0,t}async connectWithTrace(e){var t,s,a;let r;let n={baseUrl:e,steps:[]},i=async(e,t,s)=>{let a=Date.now();try{let r=await t();return n.steps.push({name:e,ok:!0,startedAt:a,endedAt:Date.now(),detail:s}),r}catch(t){throw n.steps.push({name:e,ok:!1,startedAt:a,endedAt:Date.now(),detail:s,error:t instanceof Error?t.message:String(t)}),t}};this.enclaveBaseUrl=e.replace(/\/$/,"");let d=await i("Fetch attestation (/.well-known/attestation)",async()=>await this.fetchAttestation());n.attestation={url:"".concat(this.enclaveBaseUrl,"/.well-known/attestation"),decoded:{module_id:null===(t=d.attestation_document)||void 0===t?void 0:t.module_id,timestamp:null===(s=d.attestation_document)||void 0===s?void 0:s.timestamp,pcr_count:(null===(a=d.attestation_document)||void 0===a?void 0:a.pcrs)?Object.keys(d.attestation_document.pcrs).length:void 0,public_key:d.public_key}};let o=(d.public_key||"").replace(/^0x/,"");if(o)await i("Use encryption public key from attestation",async()=>void 0,{source:"attestation"}),this.serverEncryptionPublicKeyDerHex=o,this.curve=m(o),n.encryptionPublicKey={url:"".concat(this.enclaveBaseUrl,"/.well-known/attestation"),public_key_der:o,curve:this.curve};else{let e=((await i("Fetch encryption public key (/api/encryption/public_key)",async()=>await this.call("/api/encryption/public_key","GET"))).public_key_der||"").replace(/^0x/,"");if(!e)throw Error("Failed to retrieve enclave encryption public key");this.serverEncryptionPublicKeyDerHex=e,d.public_key=e,this.curve=m(e),n.encryptionPublicKey={url:"".concat(this.enclaveBaseUrl,"/api/encryption/public_key"),public_key_der:e,curve:this.curve}}await i("Generate client ephemeral keypair",async()=>{"P-384"===this.curve?this.p384KeyPair=await crypto.subtle.generateKey({name:"ECDH",namedCurve:"P-384"},!0,["deriveBits"]):(this.secpPrivKey=l.P6.randomSecretKey(),this.secpPubKey=l.$3(this.secpPrivKey,!1))},{curve:this.curve}),await i("Import server public key",async()=>{let e=c(this.serverEncryptionPublicKeyDerHex);if("P-384"===this.curve){let t=b(e,"P-384");this.serverP384Key=await crypto.subtle.importKey("raw",t,{name:"ECDH",namedCurve:"P-384"},!0,[])}else{this.serverSecpPubKeyRaw=b(e,"secp256k1");let t=Array.from(this.serverSecpPubKeyRaw).map(e=>e.toString(16).padStart(2,"0")).join("");l.E9.fromHex(t)}},{curve:this.curve});try{if("P-384"===this.curve&&this.p384KeyPair){let e=await crypto.subtle.exportKey("raw",this.p384KeyPair.publicKey);r=y(new Uint8Array(e),"P-384").length}else"secp256k1"===this.curve&&this.secpPubKey&&(r=y(this.secpPubKey,"secp256k1").length)}catch(e){}return n.client={curve:this.curve,client_public_key_der_len:r},this.isConnected=!0,{attestation:d,trace:n}}async fetchAttestation(){var e;let t=await h(this.enclaveBaseUrl),s=t.public_key||(null===(e=t.attestation_document)||void 0===e?void 0:e.public_key)||"";return{...t,raw_doc:t.raw_doc,attestation_doc:t.raw_doc,public_key:s}}async deriveSharedKey(e){let t;let s=b(c(e),this.curve);if("P-384"===this.curve){if(!this.p384KeyPair)throw Error("P-384 keys not initialized");let e=await crypto.subtle.importKey("raw",s,{name:"ECDH",namedCurve:"P-384"},!0,[]);t=await crypto.subtle.deriveBits({name:"ECDH",public:e},this.p384KeyPair.privateKey,384)}else{if(!this.secpPrivKey)throw Error("secp256k1 keys not initialized");t=l.ZV(this.secpPrivKey,s).slice(1,33).buffer}let a=await crypto.subtle.importKey("raw",t,{name:"HKDF"},!1,["deriveKey"]);return crypto.subtle.deriveKey({name:"HKDF",hash:"SHA-256",salt:new Uint8Array(0),info:new TextEncoder().encode("encryption data")},a,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}async encrypt(e){let t;if(!this.isConnected)throw Error("Not connected");if(!this.serverEncryptionPublicKeyDerHex)throw Error("Missing enclave encryption public key; call connect() first");let s=await this.deriveSharedKey(this.serverEncryptionPublicKeyDerHex),a=crypto.getRandomValues(new Uint8Array(32)),r=await crypto.subtle.encrypt({name:"AES-GCM",iv:a.slice(0,12)},s,new TextEncoder().encode(e));return t="P-384"===this.curve?y(new Uint8Array(await crypto.subtle.exportKey("raw",this.p384KeyPair.publicKey)),"P-384"):y(this.secpPubKey,"secp256k1"),{nonce:u(a),public_key:u(t),data:u(r)}}async decrypt(e){if(!this.isConnected)throw Error("Not connected");let t=await this.deriveSharedKey(e.public_key),s=c(e.nonce).slice(0,12),a=await crypto.subtle.decrypt({name:"AES-GCM",iv:s},t,c(e.encrypted_data));return new TextDecoder().decode(a)}async callEncrypted(e,t){let s=JSON.stringify(t),a=await this.encrypt(s),r=await fetch("".concat(this.enclaveBaseUrl).concat(e),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!r.ok){let e,t;try{e=await r.text()}catch(t){e=void 0}if(e)try{let s=JSON.parse(e);"string"==typeof(null==s?void 0:s.detail)?t=s.detail:(null==s?void 0:s.detail)!=null&&(t=JSON.stringify(s.detail))}catch(e){}let s=t?": ".concat(t):e?": ".concat(e):"";throw Error("Request failed: ".concat(r.status," ").concat(r.statusText).concat(s))}let l=await r.json();return l.data&&l.data.encrypted_data?JSON.parse(await this.decrypt(l.data)):l}async callEncryptedTrace(e,t){let s=JSON.stringify(t),a=await this.encrypt(s),r="".concat(this.enclaveBaseUrl).concat(e),l={endpoint:e,url:r,curve:this.curve,server_encryption_public_key:this.serverEncryptionPublicKeyDerHex,request:{plaintext:s,encrypted_payload:a},response:{ok:!1,status:0,statusText:""}};try{let e;let t=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});l.response.ok=t.ok,l.response.status=t.status,l.response.statusText=t.statusText;try{e=await t.text()}catch(t){e=void 0}if(l.response.body_text=e,e)try{l.response.json=JSON.parse(e)}catch(e){}if(!t.ok){let e=l.response.json&&l.response.json.detail?"string"==typeof l.response.json.detail?l.response.json.detail:JSON.stringify(l.response.json.detail):void 0;return l.error="Request failed: ".concat(t.status," ").concat(t.statusText).concat(e?": ".concat(e):""),{trace:l}}let s=l.response.json;if(s&&s.data&&s.data.encrypted_data)try{let e=await this.decrypt(s.data);l.response.decrypted_plaintext=e;try{l.response.decrypted_json=JSON.parse(e)}catch(e){}if(null!=l.response.decrypted_json)return{data:l.response.decrypted_json,trace:l}}catch(e){return l.error="Failed to decrypt response: ".concat(e instanceof Error?e.message:String(e)),{trace:l}}return{data:s,trace:l}}catch(e){return l.error=e instanceof Error?e.message:String(e),{trace:l}}}async call(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",s=arguments.length>2?arguments[2]:void 0,a={method:t,headers:{"Content-Type":"application/json"}};s&&"POST"===t&&(a.body=JSON.stringify(s));let r=await fetch("".concat(this.enclaveBaseUrl).concat(e),a);if(!r.ok){let e;try{var l;let t=await r.json();e=null!==(l=t.detail)&&void 0!==l?l:t}catch(t){e=null}if(e&&"object"==typeof e&&e.message){let t=Error(e.message);throw t.detail=e,t.status=r.status,t}throw Error("Request failed: ".concat(r.status," ").concat(r.statusText))}return r.json()}async checkHealth(){return this.call("/health")}constructor(){this.enclaveBaseUrl="",this.isConnected=!1,this.curve="P-384",this.serverEncryptionPublicKeyDerHex="",this.p384KeyPair=null,this.serverP384Key=null,this.secpPrivKey=null,this.secpPubKey=null,this.serverSecpPubKeyRaw=null,this.call=this.call.bind(this),this.callEncrypted=this.callEncrypted.bind(this),this.callEncryptedTrace=this.callEncryptedTrace.bind(this),this.connect=this.connect.bind(this),this.connectWithTrace=this.connectWithTrace.bind(this),this.fetchAttestation=this.fetchAttestation.bind(this),this.checkHealth=this.checkHealth.bind(this)}}function f(){var e,t,s,l,n,c,i,d,o,x,p,h,u,m,b,y,f,g,j,N,w,k,_,S,E,C,A,P,T,D;let[K]=(0,r.useState)(()=>new v),[U,O]=(0,r.useState)({connected:!1,enclaveUrl:"http://127.0.0.1:8000"}),[R,H]=(0,r.useState)(!1),[I,J]=(0,r.useState)("identity"),[L,B]=(0,r.useState)({}),F=L[I]||null,[M,q]=(0,r.useState)(null),[G,W]=(0,r.useState)(!1),[$,V]=(0,r.useState)(!1),[z,Z]=(0,r.useState)(!1),[Q,X]=(0,r.useState)(null),[Y,ee]=(0,r.useState)(null),[et,es]=(0,r.useState)("decoded"),[ea,er]=(0,r.useState)("Hello from Nova!"),[el,en]=(0,r.useState)("user_settings"),[ec,ei]=(0,r.useState)('{"theme": "dark"}'),[ed,eo]=(0,r.useState)(null),[ex,ep]=(0,r.useState)(null),[eh,eu]=(0,r.useState)(!1),[em,eb]=(0,r.useState)(null);(0,r.useEffect)(()=>{{let e=window.location.origin;(e.includes("sparsity.cloud")||e.includes("localhost:8000"))&&O(t=>({...t,enclaveUrl:e}))}},[]);let ey=async()=>{if(U.enclaveUrl){H(!0);try{q(null),W(!1);let{attestation:e,trace:t}=await K.connectWithTrace(U.enclaveUrl);q(t);let s=await K.call("/status");O({...U,connected:!0,teeAddress:s.eth_address,error:void 0}),B(t=>({...t,identity:{success:!0,data:{attestation:e,statusInfo:s},type:"Connection"}}))}catch(e){O({...U,connected:!1,error:e instanceof Error?e.message:"Connection failed"})}finally{H(!1)}}},ev=e=>{J(e)};(0,r.useEffect)(()=>{if("events"!==I||!U.connected)return;let e=async()=>{eu(!0),eb(null);try{let e=await K.call("/api/events/monitor","GET");ep(e)}catch(t){let e=null==t?void 0:t.detail;eb((null==e?void 0:e.message)||(null==e?void 0:e.error)||(null==t?void 0:t.message)||"Unknown error")}finally{eu(!1)}};e();let t=setInterval(e,5e3);return()=>clearInterval(t)},[I,U.connected,K]);let ef=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",s=arguments.length>2?arguments[2]:void 0,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];H(!0),B(e=>({...e,[I]:null}));try{let r;r=a?await K.callEncrypted(e,s):await K.call(e,t,s),B(t=>({...t,[I]:{success:!0,data:r,type:e}}))}catch(a){var r;let t=null!==(r=null==a?void 0:a.detail)&&void 0!==r?r:null,s=a instanceof Error?a.message:"Request failed";B(a=>({...a,[I]:{success:!1,error:s,data:t,type:e}}))}finally{H(!1)}},eg=async()=>{H(!0),B(e=>({...e,"secure-echo":null})),eo(null);try{let{data:e,trace:t}=await K.callEncryptedTrace("/api/echo",{message:ea});eo(t),void 0!==e?B(t=>({...t,"secure-echo":{success:!0,data:e,type:"/api/echo (encrypted)"}})):B(e=>({...e,"secure-echo":{success:!1,error:t.error||"Request failed",type:"/api/echo (encrypted)"}}))}catch(e){B(t=>({...t,"secure-echo":{success:!1,error:e instanceof Error?e.message:"Request failed",type:"/api/echo (encrypted)"}}))}finally{H(!1)}},ej=async()=>{if(U.connected){V(!0),Z(!0),X(null),ee(null),es("decoded");try{let e=await K.fetchAttestation();ee(e)}catch(e){X(e instanceof Error?e.message:"Failed to fetch attestation")}finally{Z(!1)}}},eN=async e=>{try{await navigator.clipboard.writeText(e)}catch(s){let t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.left="-9999px",document.body.appendChild(t),t.focus(),t.select(),document.execCommand("copy"),document.body.removeChild(t)}};return(0,a.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-white via-slate-50 to-sky-50 text-slate-900 p-8 font-sans",children:[(0,a.jsx)("header",{className:"max-w-7xl mx-auto mb-12",children:(0,a.jsxs)("div",{className:"flex flex-col gap-6 rounded-3xl border border-slate-200 bg-white/95 backdrop-blur px-8 py-6 shadow-xl shadow-slate-200/50",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between gap-6 flex-wrap",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-slate-400",children:"Nova Platform"}),(0,a.jsx)("h1",{className:"text-3xl font-semibold text-slate-900 mt-2",children:"\uD83D\uDEE1️ Nova App Template"}),(0,a.jsx)("p",{className:"text-slate-500 mt-2",children:"Secure, verifiable TEE apps with RA‑TLS, S3, and on‑chain trust."})]}),(0,a.jsx)("div",{className:"min-w-[320px] flex-1 max-w-md",children:(0,a.jsxs)("div",{className:"flex items-center gap-3 rounded-2xl border border-slate-200 bg-white px-4 py-3 shadow-sm",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("label",{className:"text-[10px] uppercase tracking-widest text-slate-400",children:"Enclave URL"}),(0,a.jsx)("input",{className:"mt-1 w-full bg-transparent text-sm text-slate-700 outline-none placeholder:text-slate-400",value:U.enclaveUrl,onChange:e=>O({...U,enclaveUrl:e.target.value}),placeholder:"https://your-app.sparsity.cloud"})]}),(0,a.jsx)("button",{onClick:ey,disabled:R||U.connected,className:"px-4 py-2 rounded-xl text-sm font-semibold transition ".concat(U.connected?"bg-emerald-50 text-emerald-700 border border-emerald-200":"bg-blue-600 hover:bg-blue-500 text-white shadow-sm"),children:R?"Connecting...":U.connected?"Connected":"Connect"})]})})]}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-3 text-xs text-slate-500",children:[(0,a.jsx)("span",{className:"px-3 py-1 rounded-full bg-sky-50 border border-sky-100 text-sky-700",children:"RA‑TLS"}),(0,a.jsx)("span",{className:"px-3 py-1 rounded-full bg-sky-50 border border-sky-100 text-sky-700",children:"S3 Storage"}),(0,a.jsx)("span",{className:"px-3 py-1 rounded-full bg-sky-50 border border-sky-100 text-sky-700",children:"Oracles"}),(0,a.jsx)("span",{className:"px-3 py-1 rounded-full bg-sky-50 border border-sky-100 text-sky-700",children:"Event Listener"})]})]})}),(0,a.jsxs)("main",{className:"max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,a.jsxs)("div",{className:"lg:col-span-1 space-y-6",children:[(0,a.jsxs)("section",{className:"bg-white rounded-2xl border border-slate-200 p-6 shadow-lg shadow-slate-200/60",children:[(0,a.jsx)("h2",{className:"text-xs font-semibold text-slate-500 uppercase tracking-[0.2em] mb-4",children:"Capabilities"}),(0,a.jsx)("nav",{className:"flex flex-col gap-2",children:[{id:"identity",label:"Identity & RA-TLS",icon:"\uD83D\uDD11"},{id:"secure-echo",label:"Secure Echo",icon:"\uD83D\uDD12"},{id:"storage",label:"S3 Storage",icon:"\uD83D\uDCE6"},{id:"oracle",label:"Oracle Demo",icon:"\uD83C\uDF10"},{id:"events",label:"Event Monitor",icon:"\uD83D\uDCCA"}].map(e=>(0,a.jsxs)("button",{onClick:()=>ev(e.id),className:"group flex items-center gap-3 px-4 py-3 rounded-xl transition text-left border ".concat(I===e.id?"bg-blue-50 text-slate-900 border-blue-200 shadow-sm shadow-blue-100/60":"text-slate-600 border-transparent hover:border-slate-200 hover:bg-slate-50"),children:[(0,a.jsx)("span",{className:"text-base ".concat(I===e.id?"text-blue-600":"text-slate-400 group-hover:text-slate-600"),children:e.icon}),(0,a.jsx)("span",{className:"text-sm font-medium ".concat(I===e.id?"text-slate-900":"text-slate-600 group-hover:text-slate-900"),children:e.label})]},e.id))})]}),U.connected&&(0,a.jsxs)("section",{className:"bg-white rounded-xl border border-slate-200 p-6 shadow-sm",children:[(0,a.jsx)("h2",{className:"text-xs font-semibold text-slate-500 uppercase tracking-[0.2em] mb-3",children:"Enclave Identity"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-xs text-slate-500 block mb-1",children:"TEE Wallet Address"}),(0,a.jsx)("code",{className:"text-xs bg-slate-50 px-2 py-1 rounded block truncate border border-slate-200 text-slate-700",children:U.teeAddress})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-xs text-slate-500 block mb-1",children:"App Contract Address"}),(0,a.jsx)("code",{className:"text-xs bg-slate-50 px-2 py-1 rounded block truncate border border-slate-200 text-slate-700",children:(null===(s=L.identity)||void 0===s?void 0:null===(t=s.data)||void 0===t?void 0:null===(e=t.statusInfo)||void 0===e?void 0:e.contract_address)||"Not configured"})]}),(0,a.jsxs)("div",{className:"flex gap-2 text-xs",children:[(0,a.jsx)("span",{className:"bg-emerald-50 text-emerald-700 px-2 py-0.5 rounded border border-emerald-200",children:"Active"}),(0,a.jsx)("span",{className:"bg-blue-50 text-blue-700 px-2 py-0.5 rounded border border-blue-200",children:"Verifiable"})]})]})]})]}),(0,a.jsx)("div",{className:"lg:col-span-2 space-y-6",children:(0,a.jsxs)("div",{className:"bg-white rounded-2xl border border-slate-200 p-8 min-h-[400px] shadow-lg shadow-slate-200/60",children:["identity"===I&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Identity & RA-TLS"}),(0,a.jsx)("p",{className:"text-slate-600 text-sm leading-relaxed mb-6",children:"Establish a secure, hardware-verifiable channel with the enclave using AWS Nitro Attestation and ECDH key exchange."}),(0,a.jsx)("div",{className:"space-y-4",children:(0,a.jsxs)("div",{className:"flex gap-4",children:[(0,a.jsx)("button",{onClick:ej,disabled:R||!U.connected,className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"Fetch Attestation →"}),(0,a.jsx)("button",{onClick:()=>W(e=>!e),disabled:R||!U.connected||!M,className:"text-sm text-slate-600 hover:text-slate-800 font-medium disabled:opacity-50",children:G?"Hide RA‑TLS Trace →":"Show RA‑TLS Trace →"}),(0,a.jsx)("button",{onClick:()=>{V(!1),W(!1),ef("/api/random","GET")},disabled:R||!U.connected,className:"text-sm text-emerald-600 hover:text-emerald-700 font-medium",children:"Fetch Hardware Entropy (NSM) →"})]})}),M&&G&&(0,a.jsxs)("div",{className:"mt-6 rounded-2xl border border-slate-200 bg-slate-50 p-5",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-widest text-slate-500",children:"RA-TLS Establishment Trace"}),(0,a.jsx)("p",{className:"text-sm text-slate-700 break-all mt-1",children:M.baseUrl})]}),(0,a.jsx)("button",{onClick:()=>eN(JSON.stringify(M,null,2)),className:"px-3 py-1.5 rounded-lg text-xs font-semibold bg-white hover:bg-slate-100 text-slate-700 border border-slate-200",children:"Copy Trace JSON"})]}),(0,a.jsxs)("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"bg-white border border-slate-200 rounded-xl p-4",children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-widest text-slate-500 mb-2",children:"Key Material (metadata)"}),(0,a.jsxs)("div",{className:"text-xs text-slate-700 space-y-1",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-slate-500",children:"Curve:"})," ",(null===(l=M.encryptionPublicKey)||void 0===l?void 0:l.curve)||"—"]}),(0,a.jsxs)("div",{className:"break-all",children:[(0,a.jsx)("span",{className:"text-slate-500",children:"Server encryption public key:"})," ",(null===(n=M.encryptionPublicKey)||void 0===n?void 0:n.public_key_der)||"—"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-slate-500",children:"Client pubkey DER length:"})," ",null!==(P=null===(c=M.client)||void 0===c?void 0:c.client_public_key_der_len)&&void 0!==P?P:"—"]})]})]}),(0,a.jsxs)("div",{className:"bg-white border border-slate-200 rounded-xl p-4",children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-widest text-slate-500 mb-2",children:"Attestation (summary)"}),(0,a.jsxs)("div",{className:"text-xs text-slate-700 space-y-1",children:[(0,a.jsxs)("div",{className:"break-all",children:[(0,a.jsx)("span",{className:"text-slate-500",children:"Module ID:"})," ",(null===(d=M.attestation)||void 0===d?void 0:null===(i=d.decoded)||void 0===i?void 0:i.module_id)||"—"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-slate-500",children:"Timestamp:"})," ",(null===(x=M.attestation)||void 0===x?void 0:null===(o=x.decoded)||void 0===o?void 0:o.timestamp)?new Date(1e3*M.attestation.decoded.timestamp).toISOString():"—"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-slate-500",children:"PCR count:"})," ",null!==(T=null===(h=M.attestation)||void 0===h?void 0:null===(p=h.decoded)||void 0===p?void 0:p.pcr_count)&&void 0!==T?T:"—"]})]})]})]}),(0,a.jsxs)("div",{className:"mt-4 bg-white border border-slate-200 rounded-xl p-4",children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-widest text-slate-500 mb-3",children:"Steps"}),(0,a.jsx)("div",{className:"space-y-2",children:M.steps.map((e,t)=>(0,a.jsxs)("div",{className:"flex items-start justify-between gap-3 rounded-lg border px-3 py-2 ".concat(e.ok?"border-emerald-200 bg-emerald-50/50":"border-red-200 bg-red-50/50"),children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-xs font-semibold text-slate-800",children:e.name}),!e.ok&&e.error&&(0,a.jsx)("div",{className:"text-xs text-red-700 mt-1 break-words",children:e.error})]}),(0,a.jsxs)("div",{className:"text-[11px] text-slate-500 whitespace-nowrap",children:[e.endedAt-e.startedAt,"ms"]})]},t))})]})]})]}),"secure-echo"===I&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Secure Echo"}),(0,a.jsx)("p",{className:"text-slate-600 text-sm leading-relaxed mb-6",children:"Send an encrypted request to the enclave using ECDH + AES-GCM and (optionally) inspect the full end-to-end interaction."}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)("label",{className:"text-sm text-slate-600",children:"Message to Echo"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("input",{className:"bg-white border border-slate-300 rounded-lg px-4 py-2 flex-1 outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-100 transition",value:ea,onChange:e=>er(e.target.value)}),(0,a.jsx)("button",{onClick:eg,disabled:R||!U.connected,className:"bg-blue-600 hover:bg-blue-500 text-white px-6 py-2 rounded-lg font-semibold shadow-sm disabled:opacity-50",children:"Encrypted Send"})]})]}),ed&&(0,a.jsxs)("div",{className:"mt-2 rounded-2xl border border-slate-200 bg-slate-50 p-5",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-widest text-slate-500",children:"Encrypted Echo Trace"}),(0,a.jsx)("p",{className:"text-sm text-slate-700 break-all mt-1",children:ed.url})]}),(0,a.jsx)("button",{onClick:()=>eN(JSON.stringify(ed,null,2)),className:"px-3 py-1.5 rounded-lg text-xs font-semibold bg-white hover:bg-slate-100 text-slate-700 border border-slate-200",children:"Copy Trace JSON"})]}),ed.error&&(0,a.jsxs)("div",{className:"mt-4 bg-red-50 border border-red-200 rounded-xl p-3",children:[(0,a.jsx)("p",{className:"text-xs font-semibold text-red-700",children:"Error"}),(0,a.jsx)("p",{className:"text-xs text-red-700 break-words mt-1",children:ed.error})]}),(0,a.jsxs)("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"bg-white border border-slate-200 rounded-xl p-4",children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-widest text-slate-500 mb-2",children:"Request (plaintext)"}),(0,a.jsx)("pre",{className:"text-xs font-mono whitespace-pre-wrap break-words text-slate-700 max-h-56 overflow-auto",children:ed.request.plaintext})]}),(0,a.jsxs)("div",{className:"bg-white border border-slate-200 rounded-xl p-4",children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-widest text-slate-500 mb-2",children:"Request (encrypted envelope)"}),(0,a.jsx)("pre",{className:"text-xs font-mono whitespace-pre-wrap break-words text-slate-700 max-h-56 overflow-auto",children:JSON.stringify(ed.request.encrypted_payload,null,2)})]}),(0,a.jsxs)("div",{className:"bg-white border border-slate-200 rounded-xl p-4",children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-widest text-slate-500 mb-2",children:"Response (raw)"}),(0,a.jsxs)("div",{className:"text-[11px] text-slate-600 mb-2",children:["HTTP ",ed.response.status," ",ed.response.statusText]}),(0,a.jsx)("pre",{className:"text-xs font-mono whitespace-pre-wrap break-words text-slate-700 max-h-56 overflow-auto",children:ed.response.body_text||""})]}),(0,a.jsxs)("div",{className:"bg-white border border-slate-200 rounded-xl p-4",children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-widest text-slate-500 mb-2",children:"Response (decrypted plaintext)"}),(0,a.jsx)("pre",{className:"text-xs font-mono whitespace-pre-wrap break-words text-slate-700 max-h-56 overflow-auto",children:ed.response.decrypted_plaintext||""})]})]}),(0,a.jsxs)("div",{className:"mt-4 bg-white border border-slate-200 rounded-xl p-4",children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-widest text-slate-500 mb-2",children:"Metadata"}),(0,a.jsxs)("div",{className:"text-xs text-slate-700 space-y-1",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-slate-500",children:"Curve:"})," ",ed.curve]}),(0,a.jsxs)("div",{className:"break-all",children:[(0,a.jsx)("span",{className:"text-slate-500",children:"Server encryption public key:"})," ",ed.server_encryption_public_key||"—"]})]})]})]})]})]}),"storage"===I&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"S3 Persistent Storage"}),(0,a.jsxs)("p",{className:"text-slate-600 text-sm leading-relaxed mb-6",children:["Store and retrieve sensitive state in encrypted S3 objects. For ",(0,a.jsx)("code",{className:"bg-slate-100 px-1 rounded",children:"user_settings"})," key, the value hash is anchored on-chain and verified on retrieval."]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-2 col-span-1",children:[(0,a.jsx)("label",{className:"text-sm text-slate-600",children:"Key"}),(0,a.jsx)("input",{className:"bg-white border border-slate-300 rounded-lg px-4 py-2 outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-100",value:el,onChange:e=>en(e.target.value)})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-2 col-span-1",children:[(0,a.jsx)("label",{className:"text-sm text-slate-600",children:"Value (JSON/Text)"}),(0,a.jsx)("input",{className:"bg-white border border-slate-300 rounded-lg px-4 py-2 outline-none focus:border-emerald-500 focus:ring-2 focus:ring-emerald-100",value:ec,onChange:e=>ei(e.target.value)})]})]}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)("button",{onClick:()=>ef("/api/storage","POST",{key:el,value:ec}),disabled:R||!U.connected,className:"bg-emerald-600 hover:bg-emerald-500 text-white px-6 py-2 rounded-lg font-semibold shadow-sm flex-1",children:"Store Value"}),(0,a.jsx)("button",{onClick:()=>ef("/api/storage/".concat(el),"GET"),disabled:R||!U.connected,className:"bg-slate-100 hover:bg-slate-200 text-slate-700 px-6 py-2 rounded-lg font-semibold flex-1",children:"Retrieve Key"})]}),(0,a.jsx)("button",{onClick:()=>ef("/api/storage","GET"),className:"text-sm text-slate-500 hover:text-slate-700",children:"List all stored keys..."}),(null==F?void 0:null===(u=F.type)||void 0===u?void 0:u.includes("/api/storage"))&&F.success&&F.data&&(0,a.jsxs)("div",{className:"bg-gradient-to-br from-slate-50 to-white border border-slate-200 rounded-2xl p-5 mt-4",children:[(0,a.jsx)("h3",{className:"text-xs font-bold text-slate-500 uppercase tracking-widest mb-3",children:"On-Chain Anchoring Status"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-xs",children:[F.data.tee_address&&(0,a.jsxs)("div",{className:"bg-white border border-slate-200 rounded-xl p-3",children:[(0,a.jsx)("p",{className:"text-slate-500 mb-1",children:"TEE Wallet Address"}),(0,a.jsx)("code",{className:"text-slate-800 break-all",children:F.data.tee_address})]}),void 0!==F.data.tee_balance_eth&&(0,a.jsxs)("div",{className:"bg-white border border-slate-200 rounded-xl p-3",children:[(0,a.jsx)("p",{className:"text-slate-500 mb-1",children:"TEE Wallet Balance"}),(0,a.jsxs)("code",{className:"text-slate-800",children:[F.data.tee_balance_eth.toFixed(6)," ETH"]})]}),F.data.contract_address&&(0,a.jsxs)("div",{className:"bg-white border border-slate-200 rounded-xl p-3",children:[(0,a.jsx)("p",{className:"text-slate-500 mb-1",children:"Contract Address"}),(0,a.jsx)("code",{className:"text-slate-800 break-all",children:F.data.contract_address})]}),F.data.state_hash&&(0,a.jsxs)("div",{className:"bg-white border border-slate-200 rounded-xl p-3",children:[(0,a.jsx)("p",{className:"text-slate-500 mb-1",children:"State Hash (computed)"}),(0,a.jsx)("code",{className:"text-slate-800 break-all",children:F.data.state_hash})]}),F.data.anchor_tx&&(0,a.jsxs)("div",{className:"bg-white border border-slate-200 rounded-xl p-3 col-span-2",children:[(0,a.jsx)("p",{className:"text-slate-500 mb-1",children:"Anchor Transaction"}),(0,a.jsx)("code",{className:"text-blue-700 break-all",children:F.data.anchor_tx.transaction_hash||"—"}),void 0!==F.data.broadcast&&(0,a.jsx)("span",{className:"ml-2 ".concat(F.data.anchor_tx.broadcasted?"text-emerald-600":"text-slate-500"),children:F.data.anchor_tx.broadcasted?"(broadcasted)":"(not broadcasted)"})]}),F.data.anchor_skipped&&(0,a.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-xl p-3 col-span-2",children:[(0,a.jsx)("p",{className:"text-yellow-700 font-semibold",children:"⚠ Anchoring Skipped"}),(0,a.jsx)("p",{className:"text-yellow-600 mt-1",children:F.data.anchor_note})]}),F.data.anchor_error&&(0,a.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-xl p-3 col-span-2",children:[(0,a.jsx)("p",{className:"text-red-700 font-semibold",children:"✗ Anchor Failed"}),(0,a.jsx)("p",{className:"text-red-600 mt-1",children:F.data.anchor_error}),F.data.error_type&&(0,a.jsxs)("p",{className:"text-red-500 text-xs mt-1",children:["Error Type: ",F.data.error_type]}),F.data.hint&&(0,a.jsxs)("p",{className:"text-red-500 text-xs mt-1",children:["Hint: ",F.data.hint]})]}),F.data.onchain_hash&&(0,a.jsxs)("div",{className:"bg-white border border-slate-200 rounded-xl p-3",children:[(0,a.jsx)("p",{className:"text-slate-500 mb-1",children:"On-Chain Hash"}),(0,a.jsx)("code",{className:"text-slate-800 break-all",children:F.data.onchain_hash})]}),F.data.computed_hash&&(0,a.jsxs)("div",{className:"bg-white border border-slate-200 rounded-xl p-3",children:[(0,a.jsx)("p",{className:"text-slate-500 mb-1",children:"Computed Hash (from S3)"}),(0,a.jsx)("code",{className:"text-slate-800 break-all",children:F.data.computed_hash})]}),void 0!==F.data.verified&&(0,a.jsxs)("div",{className:"rounded-xl p-3 col-span-2 ".concat(!0===F.data.verified?"bg-emerald-50 border border-emerald-200":!1===F.data.verified?"bg-red-50 border border-red-200":"bg-yellow-50 border border-yellow-200"),children:[(0,a.jsx)("p",{className:"font-semibold ".concat(!0===F.data.verified?"text-emerald-700":!1===F.data.verified?"text-red-700":"text-yellow-700"),children:!0===F.data.verified?"✓ Data Verified — S3 data matches on-chain hash":!1===F.data.verified?"✗ Verification Failed — Hash mismatch, data untrusted":"⚠ Verification Skipped"}),F.data.verification_note&&(0,a.jsx)("p",{className:"text-xs text-slate-600 mt-1",children:F.data.verification_note})]})]})]})]}),"oracle"===I&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Oracle: Internet → Chain"}),(0,a.jsx)("p",{className:"text-slate-600 text-sm leading-relaxed mb-6",children:"The enclave fetches real-time data from the internet, processes it, and signs a cryptographically secure transaction for on-chain execution."}),(0,a.jsxs)("div",{className:"bg-gradient-to-br from-slate-50 to-white border border-slate-200 rounded-2xl p-8 flex flex-col items-center justify-center gap-6 shadow-sm",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-4xl mb-2",children:"\uD83D\uDC8E"}),(0,a.jsx)("div",{className:"text-2xl font-mono text-slate-900 tracking-tight",children:"ETH / USD"})]}),(0,a.jsx)("button",{onClick:()=>ef("/api/oracle/update-now","POST"),disabled:R||!U.connected,className:"bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-500 hover:to-indigo-500 text-white px-8 py-3 rounded-xl font-semibold shadow-lg shadow-blue-200/60",children:"Update On-Chain Now"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"bg-slate-50 p-4 rounded-xl border border-slate-200",children:[(0,a.jsx)("label",{className:"text-xs text-slate-500 block mb-1",children:"Last Cron Run"}),(0,a.jsx)("span",{className:"text-sm font-mono text-emerald-600 italic",children:U.connected&&(null===(f=L.identity)||void 0===f?void 0:null===(y=f.data)||void 0===y?void 0:null===(b=y.statusInfo)||void 0===b?void 0:null===(m=b.cron_info)||void 0===m?void 0:m.last_run)?new Date(L.identity.data.statusInfo.cron_info.last_run).toLocaleTimeString():"Awaiting sync..."})]}),(0,a.jsxs)("div",{className:"bg-slate-50 p-4 rounded-xl border border-slate-200",children:[(0,a.jsx)("label",{className:"text-xs text-slate-500 block mb-1",children:"Background Runner Status"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-2 h-2 rounded-full bg-emerald-500 animate-pulse"}),(0,a.jsxs)("span",{className:"text-xs text-slate-600",children:["Worker active • ",(null===(w=L.identity)||void 0===w?void 0:null===(N=w.data)||void 0===N?void 0:null===(j=N.statusInfo)||void 0===j?void 0:null===(g=j.cron_info)||void 0===g?void 0:g.counter)||0," tasks completed"]})]})]})]}),(0,a.jsx)("button",{onClick:()=>ef("/status","GET"),disabled:R||!U.connected,className:"w-full py-3 border border-slate-200 rounded-xl text-sm font-medium hover:bg-slate-50 transition",children:"Refresh Background Job Stats"})]}),"events"===I&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"On-Chain Event Monitor"}),(0,a.jsxs)("p",{className:"text-slate-600 text-sm leading-relaxed mb-6",children:["The enclave automatically monitors on-chain events. When an ",(0,a.jsx)("code",{className:"bg-slate-100 px-1 rounded",children:"EthPriceUpdateRequested"})," event is detected, it fetches ETH/USD and submits an on-chain update automatically."]}),(0,a.jsxs)("div",{className:"bg-slate-50 border border-slate-200 rounded-xl p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[eh?(0,a.jsx)("div",{className:"w-3 h-3 rounded-full bg-blue-500 animate-pulse"}):em?(0,a.jsx)("div",{className:"w-3 h-3 rounded-full bg-red-500"}):(null==ex?void 0:ex.status)==="active"?(0,a.jsx)("div",{className:"w-3 h-3 rounded-full bg-emerald-500 animate-pulse"}):(0,a.jsx)("div",{className:"w-3 h-3 rounded-full bg-yellow-500"}),(0,a.jsx)("span",{className:"text-sm font-medium text-slate-700",children:eh?"Loading...":em?"Error":(null==ex?void 0:ex.status)==="active"?"Monitoring Active":(null==ex?void 0:ex.status)==="not_configured"?"Contract Not Configured":"Initializing..."})]}),(0,a.jsx)("div",{className:"text-xs text-slate-500",children:(null==ex?void 0:ex.last_poll)&&(0,a.jsxs)("span",{children:["Last poll: ",new Date(ex.last_poll).toLocaleTimeString()]})})]}),(null==ex?void 0:ex.contract_address)&&(0,a.jsxs)("div",{className:"mt-2 text-xs text-slate-500",children:["Contract: ",(0,a.jsx)("code",{className:"bg-slate-100 px-1 rounded",children:ex.contract_address})]}),(null==ex?void 0:ex.current_block)&&(0,a.jsxs)("div",{className:"mt-1 text-xs text-slate-500",children:["Block: ",(0,a.jsx)("span",{className:"font-mono",children:ex.current_block})]})]}),em&&(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4",children:(0,a.jsxs)("p",{className:"text-red-700 font-semibold",children:["✗ ",em]})}),(null==ex?void 0:null===(k=ex.recent_events)||void 0===k?void 0:k.length)>0&&(0,a.jsxs)("div",{className:"bg-white border border-slate-200 rounded-2xl p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsx)("div",{className:"text-xs font-bold text-slate-500 uppercase tracking-widest",children:"Recent Events"}),ex.pending_count>0&&(0,a.jsxs)("span",{className:"bg-amber-100 text-amber-700 text-xs px-2 py-1 rounded-full",children:[ex.pending_count," pending"]})]}),(0,a.jsx)("div",{className:"overflow-auto max-h-[200px]",children:(0,a.jsxs)("table",{className:"w-full text-xs",children:[(0,a.jsx)("thead",{className:"text-slate-500",children:(0,a.jsxs)("tr",{className:"border-b border-slate-200",children:[(0,a.jsx)("th",{className:"text-left py-2 pr-3",children:"Block"}),(0,a.jsx)("th",{className:"text-left py-2 pr-3",children:"Request ID"}),(0,a.jsx)("th",{className:"text-left py-2 pr-3",children:"Status"}),(0,a.jsx)("th",{className:"text-left py-2 pr-3",children:"Price"})]})}),(0,a.jsx)("tbody",{className:"text-slate-700",children:ex.recent_events.map((e,t)=>(0,a.jsxs)("tr",{className:"border-b border-slate-100 ".concat(e.handled?"":"bg-amber-50"),children:[(0,a.jsx)("td",{className:"py-2 pr-3 font-mono",children:e.block_number}),(0,a.jsxs)("td",{className:"py-2 pr-3 font-mono",children:["#",e.request_id]}),(0,a.jsx)("td",{className:"py-2 pr-3",children:e.handled?(0,a.jsx)("span",{className:"text-emerald-600",children:"✓ handled"}):(0,a.jsx)("span",{className:"text-amber-600",children:"⏳ pending"})}),(0,a.jsx)("td",{className:"py-2 pr-3 font-mono",children:e.price_usd?"$".concat(e.price_usd):"-"})]},t))})]})})]}),(null==ex?void 0:null===(_=ex.logs)||void 0===_?void 0:_.length)>0&&(0,a.jsxs)("div",{className:"bg-slate-900 rounded-2xl p-4",children:[(0,a.jsx)("div",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest mb-3",children:"Activity Log"}),(0,a.jsx)("div",{className:"font-mono text-xs text-slate-300 space-y-1 max-h-[200px] overflow-auto",children:ex.logs.slice().reverse().map((e,t)=>(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("span",{className:"text-slate-500 shrink-0",children:new Date(e.time).toLocaleTimeString()}),(0,a.jsx)("span",{className:e.message.includes("✓")?"text-emerald-400":e.message.includes("✗")?"text-red-400":"text-slate-300",children:e.message})]},t))})]}),(null==ex?void 0:ex.last_price_usd)&&(0,a.jsxs)("div",{className:"bg-gradient-to-br from-emerald-50 to-white border border-emerald-200 rounded-xl p-4",children:[(0,a.jsx)("div",{className:"text-xs text-slate-500 mb-1",children:"Last Updated Price"}),(0,a.jsxs)("div",{className:"text-2xl font-mono text-emerald-700",children:["$",ex.last_price_usd]}),(0,a.jsxs)("div",{className:"text-xs text-slate-500 mt-1",children:[ex.last_updated_at&&(0,a.jsxs)("span",{children:["Updated: ",new Date(1e3*ex.last_updated_at).toLocaleString()]}),ex.last_reason&&(0,a.jsxs)("span",{className:"ml-2",children:["(",ex.last_reason,")"]})]})]})]}),F&&(0,a.jsxs)("div",{className:"mt-8 border-t border-slate-200 pt-8 animate-in fade-in slide-in-from-top-4 duration-300",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-3",children:[(0,a.jsxs)("h3",{className:"text-xs font-bold text-slate-500 uppercase tracking-widest",children:["Latest Response: ",F.type]}),(0,a.jsx)("span",{className:"text-[10px] font-bold px-2 py-0.5 rounded ".concat(F.success?"bg-emerald-100 text-emerald-700":"bg-red-100 text-red-700"),children:F.success?"SUCCESS":"FAILED"})]}),!F.success&&F.error&&(0,a.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4 mb-4",children:[(0,a.jsx)("p",{className:"text-sm font-semibold text-red-700",children:F.error}),F.data&&"object"==typeof F.data&&(0,a.jsxs)("div",{className:"mt-3 text-xs text-red-600 space-y-1",children:[F.data.error&&(0,a.jsxs)("p",{children:[(0,a.jsx)("span",{className:"font-semibold",children:"Error Code:"})," ",F.data.error]}),F.data.hint&&(0,a.jsxs)("p",{children:[(0,a.jsx)("span",{className:"font-semibold",children:"Hint:"})," ",F.data.hint]}),F.data.tee_address&&(0,a.jsxs)("p",{children:[(0,a.jsx)("span",{className:"font-semibold",children:"TEE Address:"})," ",(0,a.jsx)("code",{className:"bg-red-100 px-1 rounded",children:F.data.tee_address})]}),F.data.contract_address&&(0,a.jsxs)("p",{children:[(0,a.jsx)("span",{className:"font-semibold",children:"Contract:"})," ",(0,a.jsx)("code",{className:"bg-red-100 px-1 rounded",children:F.data.contract_address})]})]})]}),(0,a.jsx)("pre",{className:"bg-slate-50 rounded-xl p-5 text-xs font-mono text-slate-700 overflow-auto max-h-[300px] border border-slate-200 whitespace-pre-wrap",children:JSON.stringify(F.data||F.error,null,2)})]})]})})]}),(0,a.jsxs)("footer",{className:"max-w-6xl mx-auto mt-12 text-center text-slate-500 text-sm",children:["Built with ",(0,a.jsx)("span",{className:"text-blue-600 font-semibold",children:"Nova Platform"})," • Powered by AWS Nitro Enclaves"]}),$&&(0,a.jsx)("div",{className:"fixed inset-0 bg-slate-900/30 backdrop-blur-sm flex items-center justify-center z-50 p-6",children:(0,a.jsxs)("div",{className:"bg-white border border-slate-200 rounded-3xl shadow-2xl max-w-5xl w-full max-h-[90vh] flex flex-col overflow-hidden",children:[(0,a.jsxs)("div",{className:"px-8 py-5 border-b border-slate-200 flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-slate-900",children:"Fetch Attestation"}),(0,a.jsx)("p",{className:"text-xs text-slate-500",children:"Hardware-backed proof from AWS Nitro Enclave"})]}),(0,a.jsx)("button",{onClick:()=>V(!1),className:"text-slate-400 hover:text-slate-600 text-2xl font-bold","aria-label":"Close",children:"\xd7"})]}),(0,a.jsx)("div",{className:"px-8 py-6 overflow-auto flex-1",children:z?(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"}),(0,a.jsx)("p",{className:"mt-4 text-slate-500",children:"Loading attestation..."})]}):Q?(0,a.jsx)("div",{className:"py-8",children:(0,a.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[(0,a.jsx)("h3",{className:"text-red-700 font-semibold mb-2",children:"Failed to fetch attestation"}),(0,a.jsx)("p",{className:"text-red-600 text-sm",children:Q})]})}):Y?(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-widest text-slate-500",children:"Attestation URL (POST only)"}),(0,a.jsxs)("p",{className:"text-sm text-slate-800 break-all",children:[(U.enclaveUrl||"").replace(/\/$/,""),"/.well-known/attestation"]})]}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,a.jsx)("button",{onClick:()=>eN("".concat((U.enclaveUrl||"").replace(/\/$/,""),"/.well-known/attestation")),className:"px-3 py-1.5 rounded-lg text-xs font-semibold bg-slate-100 hover:bg-slate-200 text-slate-700 border border-slate-200",children:"Copy URL"}),(0,a.jsx)("button",{onClick:()=>eN(Y.raw_doc),className:"px-3 py-1.5 rounded-lg text-xs font-semibold bg-slate-100 hover:bg-slate-200 text-slate-700 border border-slate-200",children:"Copy Raw"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{className:"bg-slate-50 border border-slate-200 rounded-2xl p-4",children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-widest text-slate-500",children:"Module ID"}),(0,a.jsx)("p",{className:"mt-2 text-sm text-slate-800 break-all",children:(null===(S=Y.attestation_document)||void 0===S?void 0:S.module_id)||"—"})]}),(0,a.jsxs)("div",{className:"bg-slate-50 border border-slate-200 rounded-2xl p-4",children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-widest text-slate-500",children:"Timestamp"}),(0,a.jsx)("p",{className:"mt-2 text-sm text-slate-800",children:(null===(E=Y.attestation_document)||void 0===E?void 0:E.timestamp)?new Date(1e3*Y.attestation_document.timestamp).toISOString():"—"})]}),(0,a.jsxs)("div",{className:"bg-slate-50 border border-slate-200 rounded-2xl p-4",children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-widest text-slate-500",children:"PCRs"}),(0,a.jsxs)("p",{className:"mt-2 text-sm text-slate-800",children:[(null===(C=Y.attestation_document)||void 0===C?void 0:C.pcrs)?Object.keys(Y.attestation_document.pcrs).length:0," slots"]})]})]}),(null===(A=Y.attestation_document)||void 0===A?void 0:A.pcrs)&&(0,a.jsxs)("div",{className:"bg-slate-50 border border-slate-200 rounded-2xl p-4",children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-widest text-slate-500 mb-3",children:"PCR Values"}),(0,a.jsx)("div",{className:"space-y-2",children:Object.entries(Y.attestation_document.pcrs).sort((e,t)=>{let[s]=e,[a]=t;return Number(s)-Number(a)}).map(e=>{let[t,s]=e;return(0,a.jsxs)("div",{className:"flex flex-col md:flex-row md:items-start md:gap-3",children:[(0,a.jsxs)("span",{className:"text-xs font-semibold text-slate-600 w-12 shrink-0",children:["PCR",t]}),(0,a.jsx)("code",{className:"text-xs text-slate-700 break-all bg-white border border-slate-200 rounded-lg px-2 py-1",children:s})]},t)})})]}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:[{id:"decoded",label:"Decoded"},{id:"raw",label:"Raw (base64)"},{id:"full",label:"Full JSON"}].map(e=>(0,a.jsx)("button",{onClick:()=>es(e.id),className:"px-3 py-1.5 rounded-lg text-xs font-semibold border transition ".concat(et===e.id?"bg-blue-600 text-white border-blue-600":"bg-white text-slate-700 border-slate-200 hover:bg-slate-50"),children:e.label},e.id))}),"raw"===et?(0,a.jsx)("div",{className:"bg-slate-50 border border-slate-200 rounded-2xl p-4 overflow-auto max-h-[50vh]",children:(0,a.jsx)("code",{className:"text-xs text-slate-700 block whitespace-pre-wrap break-words",children:Y.raw_doc})}):(0,a.jsx)("div",{className:"bg-slate-50 border border-slate-200 rounded-2xl p-4 overflow-auto max-h-[50vh]",children:(0,a.jsx)("code",{className:"text-xs text-slate-700 block whitespace-pre-wrap break-words",dangerouslySetInnerHTML:{__html:(D=JSON.stringify("decoded"===et?Y.attestation_document:Y,null,2))?D.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?)/g,e=>/^".*"\s*:?$/.test(e)?/":$/.test(e)?'<span class="text-sky-700 font-semibold">'.concat(e,"</span>"):'<span class="text-emerald-700">'.concat(e,"</span>"):/true|false/.test(e)?'<span class="text-violet-700">'.concat(e,"</span>"):/null/.test(e)?'<span class="text-slate-500">'.concat(e,"</span>"):'<span class="text-amber-700">'.concat(e,"</span>")):""}})})]}):null}),(0,a.jsx)("div",{className:"px-8 py-5 border-t border-slate-200 flex justify-end",children:(0,a.jsx)("button",{onClick:()=>V(!1),className:"px-4 py-2 bg-slate-100 text-slate-700 rounded-lg hover:bg-slate-200",children:"Close"})})]})})]})}new v}},function(e){e.O(0,[815,971,117,744],function(){return e(e.s=2201)}),_N_E=e.O()}]);